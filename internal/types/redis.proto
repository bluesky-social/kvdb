syntax = "proto3";

package types;
option go_package = "github.com/bluesky-social/kvdb/internal/types";

import "google/protobuf/timestamp.proto";

message User {
  string username = 1;
  bytes password_hash = 2;
  google.protobuf.Timestamp created = 3;
  google.protobuf.Timestamp last_login = 4;
  bool enabled = 5;
  repeated UserACLRule rules = 6;
}

message UserACLRule {
  UserAccessLevel level = 1;
}

enum UserAccessLevel {
  USER_ACCESS_LEVEL_UNSPECIFIED = 0;
  USER_ACCESS_LEVEL_CLUSTER_ADMIN = 1;
  USER_ACCESS_LEVEL_READ_WRITE = 3;
  USER_ACCESS_LEVEL_READ= 4;
}

message ObjectMeta {
  google.protobuf.Timestamp created = 1;
  google.protobuf.Timestamp updated = 2;
  optional google.protobuf.Timestamp expires = 3;
  oneof type {
    BasicObjectMeta basic = 4;
    SetMeta set = 5;
    SortedSetMeta sorted_set = 6;
    ListMeta list = 7;
    ListItemMeta list_item = 8;
  }
}

message BasicObjectMeta {
  uint32 num_chunks = 1;
  uint64 size_bytes = 2;
}

message SetMeta {
  uint64 num_items = 1;
  uint32 num_chunks = 2;
  uint64 size_bytes = 3;
}

message SortedSetMeta {
  uint64 num_items = 1;
  uint32 num_chunks = 2;
  uint64 size_bytes = 3;
}

message ListMeta {
  uint64 num_items = 1;
  string item_head = 2;
  string item_tail= 3;
}

message ListItemMeta {
  string id = 1;
  string next = 2;
  string previous = 3;
  uint32 num_chunks = 4;
  uint64 size_bytes = 5;
}

message UIDItem {
  string member = 1;
  uint64 uid = 2;
  optional float score = 3;
}
